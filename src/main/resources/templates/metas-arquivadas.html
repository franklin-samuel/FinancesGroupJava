<!doctype html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org" x-data="{ selectedMetaId: null, modalParabens: false }" class="min-h-screen bg-gradient-to-br from-dark-900 via-slate-900 to-dark-800 text-gray-100">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metas Arquivadas - FinTrack</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/lucide/dist/lucide.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'dark': {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            400: '#94a3b8',
                            500: '#64748b',
                            600: '#475569',
                            700: '#334155',
                            800: '#1e293b',
                            900: '#0f172a',
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="min-h-screen bg-gradient-to-br from-dark-900 via-slate-900 to-dark-800 text-gray-100">
<div class="container mx-auto px-6 py-8 max-w-6xl">
    <!-- Cabeçalho -->
    <div class="mb-8">
        <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-4">
            <div>
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-12 h-12 bg-gradient-to-r from-emerald-600 to-green-600 rounded-xl flex items-center justify-center">
                        <i data-lucide="trophy" class="w-6 h-6 text-white"></i>
                    </div>
                    <h1 class="text-3xl font-bold text-white">Metas Arquivadas</h1>
                </div>
                <p class="text-gray-400">Celebre suas conquistas! Aqui estão todas as metas que você concluiu com sucesso.</p>
            </div>
            <div class="flex gap-3">
                <a href="/" class="flex items-center gap-2 bg-dark-700 hover:bg-dark-600 text-gray-300 hover:text-white px-5 py-2.5 rounded-lg font-medium transition-all duration-200 shadow-lg border border-dark-600">
                    <i data-lucide="arrow-left" class="w-4 h-4"></i>
                    Voltar ao Início
                </a>
            </div>
        </div>
    </div>

    <!-- Estatísticas Rápidas -->
    <div class="grid md:grid-cols-3 gap-6 mb-8">
        <div class="bg-gradient-to-r from-dark-800/80 to-dark-700/80 backdrop-blur-sm border border-dark-600/50 rounded-xl p-6 shadow-2xl">
            <div class="flex items-center gap-3 mb-2">
                <div class="w-10 h-10 bg-emerald-500/20 rounded-lg flex items-center justify-center">
                    <i data-lucide="trophy" class="w-5 h-5 text-emerald-400"></i>
                </div>
                <span class="text-gray-400 font-medium">Metas Concluídas</span>
            </div>
            <p class="text-2xl font-bold text-white" th:text="${#lists.size(metasConcluidas)}">0</p>
        </div>
        <div class="bg-gradient-to-r from-dark-800/80 to-dark-700/80 backdrop-blur-sm border border-dark-600/50 rounded-xl p-6 shadow-2xl">
            <div class="flex items-center gap-3 mb-2">
                <div class="w-10 h-10 bg-blue-500/20 rounded-lg flex items-center justify-center">
                    <i data-lucide="dollar-sign" class="w-5 h-5 text-blue-400"></i>
                </div>
                <span class="text-gray-400 font-medium">Valor Total Arrecadado</span>
            </div>
            <p class="text-2xl font-bold text-emerald-400">
                R$ <span th:text="${#numbers.formatDecimal(#aggregates.sum(metasConcluidas.![valorAtual]), 1, 2)}">0,00</span>
            </p>
        </div>
        <div class="bg-gradient-to-r from-dark-800/80 to-dark-700/80 backdrop-blur-sm border border-dark-600/50 rounded-xl p-6 shadow-2xl">
            <div class="flex items-center gap-3 mb-2">
                <div class="w-10 h-10 bg-amber-500/20 rounded-lg flex items-center justify-center">
                    <i data-lucide="target" class="w-5 h-5 text-amber-400"></i>
                </div>
                <span class="text-gray-400 font-medium">Objetivos Alcançados</span>
            </div>
            <p class="text-2xl font-bold text-amber-400">
                R$ <span th:text="${#numbers.formatDecimal(#aggregates.sum(metasConcluidas.![valorTotal]), 1, 2)}">0,00</span>
            </p>
        </div>
    </div>

    <!-- Lista de Metas Arquivadas -->
    <div class="bg-gradient-to-r from-dark-800/80 to-dark-700/80 backdrop-blur-sm border border-dark-600/50 rounded-xl p-6 shadow-2xl">
        <div class="flex items-center gap-3 mb-6">
            <i data-lucide="archive" class="w-6 h-6 text-emerald-400"></i>
            <h2 class="text-2xl font-bold text-white">Suas Conquistas</h2>
        </div>

        <div class="space-y-4">
            <div th:each="meta, metaStat : ${metasConcluidas}"
                 @click="selectedMetaId = $el.dataset.metaId; modalParabens = true"
                 th:attr="data-meta-id=${meta.id}"
                 class="group bg-dark-900/50 border border-emerald-500/30 rounded-xl p-6 cursor-pointer hover:bg-dark-800/60 hover:border-emerald-400/50 transition-all duration-300 transform hover:scale-[1.02] hover:shadow-lg relative overflow-hidden">

                <!-- Efeito de brilho no hover -->
                <div class="absolute inset-0 bg-gradient-to-r from-emerald-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none"></div>

                <div class="relative">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex items-center gap-4">
                            <div class="w-14 h-14 bg-gradient-to-r from-emerald-500 to-green-500 rounded-xl flex items-center justify-center text-white font-bold text-lg group-hover:scale-110 transition-transform duration-200 shadow-lg">
                                <i data-lucide="trophy" class="w-7 h-7"></i>
                            </div>
                            <div>
                                <div class="flex items-center gap-3 mb-2">
                                    <h3 class="text-xl font-semibold text-white group-hover:text-emerald-300 transition-colors" th:text="${meta.nome}">Nome da Meta</h3>
                                    <span class="bg-emerald-500/20 text-emerald-400 text-xs font-bold px-3 py-1 rounded-full border border-emerald-500/30">
                                        ✓ CONCLUÍDA
                                    </span>
                                </div>
                                <div class="flex items-center gap-4 text-sm text-gray-400">
                                    <span>Concluída em: <span class="text-emerald-400" th:text="${#temporals.format(meta.concluidaEm, 'dd/MM/yyyy')}">Data</span></span>
                                    <span>•</span>
                                    <span><span th:text="${#lists.size(meta.integrantes)}">0</span> participante(s)</span>
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="flex items-center gap-2 mb-1">
                                <i data-lucide="check-circle" class="w-5 h-5 text-emerald-400"></i>
                                <span class="text-2xl font-bold text-emerald-400" th:text="'R$ ' + ${#numbers.formatDecimal(meta.valorTotal, 1, 2)}">R$ 0,00</span>
                            </div>
                            <div class="flex items-center gap-2 text-gray-400">
                                <i data-lucide="mouse-pointer-click" class="w-4 h-4 group-hover:scale-110 transition-transform duration-200"></i>
                                <span class="text-sm">Clique para celebrar</span>
                            </div>
                        </div>
                    </div>

                    <!-- Progress Bar (sempre 100% para metas concluídas) -->
                    <div class="mt-4">
                        <div class="flex justify-between text-sm text-gray-400 mb-2">
                            <span>Meta Alcançada</span>
                            <span class="text-emerald-400 font-semibold">100%</span>
                        </div>
                        <div class="w-full bg-dark-700/50 rounded-full h-3">
                            <div class="bg-gradient-to-r from-emerald-500 to-green-500 h-3 rounded-full w-full relative overflow-hidden">
                                <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent animate-pulse"></div>
                                <div class="absolute right-2 top-1/2 transform -translate-y-1/2">
                                    <i data-lucide="check" class="w-3 h-3 text-white"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Resumo dos Integrantes -->
                    <div class="mt-4 flex items-center gap-2">
                        <i data-lucide="users" class="w-4 h-4 text-gray-400"></i>
                        <div class="flex -space-x-2">
                            <div th:each="integrante, iterStat : ${meta.integrantes}"
                                 th:if="${iterStat.index < 3}"
                                 class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-semibold text-xs border-2 border-dark-900"
                                 th:text="${integrante.nome.substring(0,1).toUpperCase()}">N</div>
                            <div th:if="${#lists.size(meta.integrantes) > 3}"
                                 class="w-8 h-8 bg-dark-600 rounded-full flex items-center justify-center text-gray-300 text-xs border-2 border-dark-900"
                                 th:text="'+' + ${#lists.size(meta.integrantes) - 3}">+2</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Estado Vazio -->
        <div th:if="${#lists.isEmpty(metasConcluidas)}" class="text-center py-12">
            <div class="w-16 h-16 bg-dark-700/50 rounded-full flex items-center justify-center mx-auto mb-4">
                <i data-lucide="trophy" class="w-8 h-8 text-gray-500"></i>
            </div>
            <h3 class="text-xl font-semibold text-gray-400 mb-2">Nenhuma meta concluída ainda</h3>
            <p class="text-gray-500 mb-6">Continue trabalhando em suas metas ativas para ver suas conquistas aqui!</p>
            <a href="/"
               class="inline-flex items-center gap-2 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white px-6 py-3 rounded-lg font-medium transition-all duration-200 shadow-lg hover:shadow-blue-500/25">
                <i data-lucide="arrow-left" class="w-4 h-4"></i>
                Voltar às Metas Ativas
            </a>
        </div>
    </div>

    <!-- Modal de Parabéns -->
    <div x-show="modalParabens" x-transition.opacity.duration.500ms
         class="fixed inset-0 flex items-center justify-center bg-black/80 backdrop-blur-sm z-50">
        <div @click.away="modalParabens = false"
             x-transition.scale.origin.center.duration.300ms
             class="bg-gradient-to-br from-dark-800 to-dark-900 border border-emerald-500/50 p-8 rounded-2xl shadow-2xl w-full max-w-lg mx-4 relative overflow-hidden">

            <div class="absolute inset-0 pointer-events-none">
                <div class="absolute top-4 left-4 w-2 h-2 bg-yellow-400 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                <div class="absolute top-8 right-6 w-2 h-2 bg-blue-400 rounded-full animate-bounce" style="animation-delay: 0.3s"></div>
                <div class="absolute top-16 left-8 w-1 h-1 bg-red-400 rounded-full animate-bounce" style="animation-delay: 0.5s"></div>
                <div class="absolute top-12 right-12 w-1 h-1 bg-green-400 rounded-full animate-bounce" style="animation-delay: 0.7s"></div>
                <div class="absolute bottom-16 left-6 w-2 h-2 bg-purple-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                <div class="absolute bottom-8 right-8 w-1 h-1 bg-pink-400 rounded-full animate-bounce" style="animation-delay: 0.6s"></div>
            </div>

            <!-- Conteúdo do Modal -->
            <div class="text-center relative z-10">
                <div class="w-24 h-24 bg-gradient-to-r from-emerald-500 to-green-500 rounded-full flex items-center justify-center mx-auto mb-6 animate-pulse">
                    <i data-lucide="trophy" class="w-12 h-12 text-white"></i>
                </div>

                <!-- Título -->
                <h2 class="text-3xl font-bold text-white mb-2">🎉 Parabéns!</h2>
                <p class="text-emerald-400 text-xl font-semibold mb-6">Essa foi uma grande conquista!</p>

                <!-- Template que será mostrado quando uma meta específica for selecionada -->
                <template x-for="meta in [] || []" :key="meta.id">
                    <div x-show="selectedMetaId && selectedMetaId == meta.id">
                        <!-- Detalhes da Meta -->
                        <div class="bg-dark-900/50 rounded-xl p-6 mb-6 border border-emerald-500/30">
                            <h3 class="text-lg font-bold text-white mb-4" x-text="meta.nome">Nome da Meta</h3>
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div>
                                    <span class="text-gray-400">Valor da Meta:</span>
                                    <p class="text-white font-semibold" x-text="'R$ ' + meta.valorTotal.toFixed(2).replace('.', ',')">R$ 0,00</p>
                                </div>
                                <div>
                                    <span class="text-gray-400">Valor Arrecadado:</span>
                                    <p class="text-emerald-400 font-semibold" x-text="'R$ ' + meta.valorAtual.toFixed(2).replace('.', ',')">R$ 0,00</p>
                                </div>
                                <div>
                                    <span class="text-gray-400">Data de Criação:</span>
                                    <p class="text-white font-semibold" x-text="meta.criadaEm">Data</p>
                                </div>
                                <div>
                                    <span class="text-gray-400">Data de Conclusão:</span>
                                    <p class="text-emerald-400 font-semibold" x-text="meta.concluidaEm">Data</p>
                                </div>
                            </div>
                        </div>

                        <!-- Lista de Integrantes -->
                        <div class="bg-dark-900/50 rounded-xl p-4 mb-6 border border-emerald-500/30">
                            <h4 class="text-white font-semibold mb-3 flex items-center gap-2">
                                <i data-lucide="users" class="w-4 h-4 text-emerald-400"></i>
                                Participantes
                            </h4>
                            <div class="space-y-2 max-h-32 overflow-y-auto custom-scrollbar">
                                <template x-for="integrante in meta.integrantes || []" :key="integrante.nome">
                                    <div class="flex justify-between items-center text-sm">
                                        <span class="text-gray-300" x-text="integrante.nome">Nome</span>
                                        <span class="text-emerald-400 font-medium">
                                            R$ <span x-text="integrante.contribuicao.toFixed(2).replace('.', ',')">0,00</span>
                                        </span>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </template>

                <div th:each="meta : ${metasConcluidas}" x-show="selectedMetaId && selectedMetaId == $el.dataset.metaId" th:attr="data-meta-id=${meta.id}">
                    <!-- Detalhes da Meta -->
                    <div class="bg-dark-900/50 rounded-xl p-6 mb-6 border border-emerald-500/30">
                        <h3 class="text-lg font-bold text-white mb-4" th:text="${meta.nome}">Nome da Meta</h3>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div>
                                <span class="text-gray-400">Valor da Meta:</span>
                                <p class="text-white font-semibold" th:text="'R$ ' + ${#numbers.formatDecimal(meta.valorTotal, 1, 2)}">R$ 0,00</p>
                            </div>
                            <div>
                                <span class="text-gray-400">Valor Arrecadado:</span>
                                <p class="text-emerald-400 font-semibold" th:text="'R$ ' + ${#numbers.formatDecimal(meta.valorAtual, 1, 2)}">R$ 0,00</p>
                            </div>
                            <div>
                                <span class="text-gray-400">Data de Criação:</span>
                                <p class="text-white font-semibold" th:text="${#temporals.format(meta.criadaEm, 'dd/MM/yyyy')}">Data</p>
                            </div>
                            <div>
                                <span class="text-gray-400">Data de Conclusão:</span>
                                <p class="text-emerald-400 font-semibold" th:text="${#temporals.format(meta.concluidaEm, 'dd/MM/yyyy')}">Data</p>
                            </div>
                        </div>
                    </div>

                    <!-- Lista de Integrantes -->
                    <div class="bg-dark-900/50 rounded-xl p-4 mb-6 border border-emerald-500/30">
                        <h4 class="text-white font-semibold mb-3 flex items-center gap-2">
                            <i data-lucide="users" class="w-4 h-4 text-emerald-400"></i>
                            Participantes
                        </h4>
                        <div class="space-y-2 max-h-32 overflow-y-auto custom-scrollbar">
                            <div th:each="integrante : ${meta.integrantes}" class="flex justify-between items-center text-sm">
                                <span class="text-gray-300" th:text="${integrante.nome}">Nome</span>
                                <span class="text-emerald-400 font-medium">
                                    R$ <span th:text="${#numbers.formatDecimal(integrante.contribuicao, 1, 2)}">0,00</span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Botões de Ação -->
                <div class="flex gap-3">
                    <button @click="downloadCertificado(selectedMetaId)"
                            class="flex-1 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white px-4 py-3 rounded-lg font-medium transition-all duration-200 shadow-lg hover:shadow-blue-500/25 flex items-center justify-center gap-2">
                        <i data-lucide="download" class="w-4 h-4"></i>
                        Baixar Certificado
                    </button>
                </div>

                <button @click="modalParabens = false; selectedMetaId = null"
                        class="mt-4 text-gray-400 hover:text-white transition-colors text-sm">
                    Fechar
                </button>
            </div>
        </div>
    </div>
</div>

<style>
    body {
        height: 100%;
        padding-bottom: env(safe-area-inset-bottom);
        padding-left: env(safe-area-inset-left);
        padding-top: env(safe-area-inset-top);
        padding-right: env(safe-area-inset-right);
    }
    .custom-scrollbar::-webkit-scrollbar {
        width: 4px;
    }
    .custom-scrollbar::-webkit-scrollbar-track {
        background: rgba(51, 65, 85, 0.3);
        border-radius: 2px;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb {
        background: rgba(99, 102, 241, 0.5);
        border-radius: 2px;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background: rgba(99, 102, 241, 0.7);
    }
</style>

<script src="https://unpkg.com/lucide@latest"></script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        lucide.createIcons();

        document.addEventListener('alpine:updated', () => {
            lucide.createIcons();
        });
    });

    function downloadCertificado(metaId) {
        console.log('Tentando baixar certificado para meta ID:', metaId);

        if (!metaId) {
            console.error('ID da meta não encontrado');
            alert('Erro: ID da meta não encontrado');
            return;
        }

        try {
            window.location.href = `/meta/${metaId}/certificado`;
        } catch (error) {
            console.error('Erro ao baixar certificado:', error);
            alert('Erro ao baixar certificado. Tente novamente.');
        }
    }
</script>
</body>
</html>